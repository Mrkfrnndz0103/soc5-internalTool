"use strict";(()=>{var e={};e.id=4728,e.ids=[4728],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},85807:e=>{e.exports=require("module")},55315:e=>{e.exports=require("path")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},8678:e=>{e.exports=import("pg")},92761:e=>{e.exports=require("node:async_hooks")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},15673:e=>{e.exports=require("node:events")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},40421:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a=r(49303),o=r(88716),n=r(60670),i=r(68727),u=e([i]);i=(u.then?(await u)():u)[0];let l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/hubs/route",pathname:"/api/hubs",filename:"route",bundlePath:"app/api/hubs/route"},resolvedPagePath:"C:\\Users\\phlspxuser\\Documents\\Mrkcde\\Ongoing\\soc5-internalTool\\src\\app\\api\\hubs\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=l,x="/api/hubs/route";function p(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}s()}catch(e){s(e)}})},68727:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>m,POST:()=>x});var a=r(87070),o=r(75748),n=r(95456),i=r(11958),u=r(76097),p=r(84235),l=r(21067),c=e([o,n,u]);[o,n,u]=c.then?(await c)():c;let d=l.Ry({cluster_name:l.Z_().trim().min(1).optional(),hub_name:l.Z_().trim().min(1).optional(),region:l.Z_().trim().min(1).optional(),dock_number:l.Z_().trim().min(1).optional(),active:l.O7().optional()}).strict().refine(e=>Object.keys(e).length>0,{message:"hub data is required"}),m=(0,i.g)("/api/hubs",async e=>{if(!await (0,n.Gg)())return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=Number(t.get("limit")||"10"),s=Number(t.get("offset")||"0"),i=t.get("active"),u=null===i?void 0:"true"===i,p=[],l=[];void 0!==u&&(l.push(u),p.push(`active = $${l.length}`));let c=p.length?`WHERE ${p.join(" AND ")}`:"",d=await (0,o.I)(`SELECT COUNT(*)::int AS total
     FROM outbound_map
     ${c}`,l),m=await (0,o.I)(`SELECT *
     FROM outbound_map
     ${c}
     ORDER BY hub_name
     LIMIT $${l.length+1}
     OFFSET $${l.length+2}`,[...l,r,s]);return a.NextResponse.json({hubs:m.rows,total:d.rows[0]?.total||0},{headers:{"Cache-Control":"private, max-age=30, stale-while-revalidate=60"}})}),x=(0,i.g)("/api/hubs",async e=>{let t=await (0,n.Gg)();if(!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await (0,u.l)(t.sessionId);if(!r.allowed)return a.NextResponse.json({error:"Too many requests"},{status:429,headers:{"Retry-After":String(r.retryAfterSeconds)}});let s=await (0,p.Y)(e,d);if(s.errorResponse)return s.errorResponse;let i=Object.entries(s.data),l=i.map(([e])=>`"${e}"`).join(", "),c=i.map((e,t)=>`$${t+1}`).join(", "),m=i.map(([,e])=>e),x=await (0,o.I)(`INSERT INTO outbound_map (${l})
     VALUES (${c})
     RETURNING *`,m);return a.NextResponse.json(x.rows[0])});s()}catch(e){s(e)}})},76097:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{l:()=>i});var a=r(75748),o=e([a]);function n(e,t){if(!e)return t;let r=Number(e);return!Number.isFinite(r)||r<=0?t:r}a=(o.then?(await o)():o)[0];let u=n(process.env.RATE_LIMIT_WINDOW_MS,6e4),p=n(process.env.RATE_LIMIT_MAX_REQUESTS,60);async function i(e,t){let r=t?.windowMs??u,s=t?.limit??p,o=`${Math.max(1,Math.floor(r/1e3))} seconds`,n=(await (0,a.I)(`INSERT INTO session_rate_limits (session_id, count, expires_at)
     VALUES ($1, 1, NOW() + $2::interval)
     ON CONFLICT (session_id)
     DO UPDATE SET
       count = CASE WHEN session_rate_limits.expires_at < NOW() THEN 1 ELSE session_rate_limits.count + 1 END,
       expires_at = CASE WHEN session_rate_limits.expires_at < NOW() THEN NOW() + $2::interval ELSE session_rate_limits.expires_at END
     RETURNING count, expires_at`,[e,o])).rows[0];if((n?.count??s+1)>s){let e=n?.expires_at?new Date(n.expires_at).getTime():Date.now()+r,t=Math.max(1,Math.ceil((e-Date.now())/1e3));return{allowed:!1,retryAfterSeconds:t,limit:s}}return{allowed:!0,retryAfterSeconds:0,limit:s}}s()}catch(e){s(e)}})},84235:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(87070);async function a(e,t){let r=await e.json().catch(()=>void 0),a=t.safeParse(r??{});if(!a.success){let e=a.error.flatten(),t=a.error.errors[0]?.message||"Invalid request";return{errorResponse:s.NextResponse.json({error:t,details:e},{status:400})}}return{data:a.data}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,7936,1067,5456],()=>r(40421));module.exports=s})();