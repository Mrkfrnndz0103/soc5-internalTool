"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},73811:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s=r(49303),a=r(88716),n=r(60670),i=r(76344),l=e([i]);i=(l.then?(await l)():l)[0];let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\phlspxuser\\Documents\\Mrkcde\\Ongoing\\soc5-internalTool\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=u,h="/api/auth/login/route";function p(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}o()}catch(e){o(e)}})},76344:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{POST:()=>p});var s=r(87070),a=r(84770),n=r(75748),i=e([n]);n=(i.then?(await i)():i)[0];let u="shopeemobile-external.com,spxexpress.com".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);function l(e){let t=e.split("@")[1]?.toLowerCase()||"";return t&&u.includes(t)}async function p(e){let t=await e.json().catch(()=>({})),r=t?.ops_id;if(!r)return s.NextResponse.json({error:"ops_id is required"},{status:400});if(r.includes("@")&&!l(r))return s.NextResponse.json({error:"Email domain is not allowed"},{status:403});let o=await (0,n.I)(`SELECT ops_id, name, role, email
     FROM users
     WHERE ops_id = $1 OR email = $1
     LIMIT 1`,[r]);if(0===o.rows.length)return s.NextResponse.json({error:"Invalid credentials"},{status:401});let i=o.rows[0];if(i.email&&!l(i.email))return s.NextResponse.json({error:"Email domain is not allowed"},{status:403});let p=(0,a.randomUUID)();return s.NextResponse.json({user:{ops_id:i.ops_id,name:i.name,role:i.role,email:i.email},token:p})}o()}catch(e){o(e)}})},75748:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{I:()=>n});var s=r(8678),a=e([s]);s=(a.then?(await a)():a)[0];let i=process.env.DATABASE_URL;if(!i)throw Error("DATABASE_URL is not set");let l="true"===process.env.DATABASE_SSL,p=globalThis.__pgPool||new s.Pool({connectionString:i,ssl:l?{rejectUnauthorized:!1}:void 0});async function n(e,t){return p.query(e,t)}globalThis.__pgPool||(globalThis.__pgPool=p),o()}catch(e){o(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>r(73811));module.exports=o})();