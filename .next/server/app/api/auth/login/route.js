"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},73811:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var o=s(49303),a=s(88716),i=s(60670),n=s(76344),l=e([n]);n=(l.then?(await l)():l)[0];let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\phlspxuser\\Documents\\Mrkcde\\Ongoing\\soc5-internalTool\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:h}=u,m="/api/auth/login/route";function p(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}r()}catch(e){r(e)}})},76344:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{POST:()=>p});var o=s(87070),a=s(84770),i=s(75748),n=e([i]);i=(n.then?(await n)():n)[0];let u="shopeemobile-external.com,spxexpress.com".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);function l(e){let t=e.split("@")[1]?.toLowerCase()||"";return t&&u.includes(t)}async function p(e){let t=await e.json().catch(()=>({})),s=t?.ops_id,r=t?.password;if(!s)return o.NextResponse.json({error:"ops_id is required"},{status:400});if(s.includes("@")&&!l(s))return o.NextResponse.json({error:"Email domain is not allowed"},{status:403});let n=await (0,i.I)(`SELECT id, ops_id, name, role, email, is_first_time, must_change_password, password_hash
     FROM users
     WHERE ops_id = $1 OR email = $1
     LIMIT 1`,[s]);if(0===n.rows.length)return o.NextResponse.json({error:"Invalid credentials"},{status:401});let p=n.rows[0];if(p.email&&!l(p.email))return o.NextResponse.json({error:"Email domain is not allowed"},{status:403});if(r&&p.password_hash&&p.password_hash!==r)return o.NextResponse.json({error:"Invalid credentials"},{status:401});let u=(0,a.randomUUID)();return o.NextResponse.json({user:{ops_id:p.ops_id,name:p.name,role:p.role,email:p.email,is_first_time:p.is_first_time,must_change_password:p.must_change_password},token:u})}r()}catch(e){r(e)}})},75748:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{I:()=>i});var o=s(8678),a=e([o]);o=(a.then?(await a)():a)[0];let n=process.env.DATABASE_URL;if(!n)throw Error("DATABASE_URL is not set");let l="true"===process.env.DATABASE_SSL,p=globalThis.__pgPool||new o.Pool({connectionString:n,ssl:l?{rejectUnauthorized:!1}:void 0});async function i(e,t){return p.query(e,t)}globalThis.__pgPool||(globalThis.__pgPool=p),r()}catch(e){r(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>s(73811));module.exports=r})();