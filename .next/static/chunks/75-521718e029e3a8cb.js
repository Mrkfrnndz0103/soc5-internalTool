(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75],{4075:function(e,t,s){Promise.resolve().then(s.bind(s,4852))},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var r=s(7437),a=s(2265),n=s(7053),d=s(535),i=s(3448);let l=(0,d.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:s,variant:a,size:d,asChild:c=!1,...o}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(l({variant:a,size:d,className:s})),ref:t,...o})});c.displayName="Button"},9820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return d},aY:function(){return o},ll:function(){return l}});var r=s(7437),a=s(2265),n=s(3448);let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,"data-slot":"card",className:(0,n.cn)("rounded-xl border bg-card text-card-foreground","shadow-[0_2px_8px_rgba(0,0,0,0.08)]",s),...a})});d.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,"data-slot":"card-header",className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...a})});o.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},279:function(e,t,s){"use strict";s.d(t,{I:function(){return d}});var r=s(7437),a=s(2265),n=s(3448);let d=a.forwardRef((e,t)=>{let{className:s,type:a,...d}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...d})});d.displayName="Input"},8752:function(e,t,s){"use strict";s.d(t,{pm:function(){return m}});var r=s(2265);let a=0,n=new Map,d=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?d(s):e.toasts.forEach(e=>{d(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function o(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},4881:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return c}});var r=s(7437),a=s(2265),n=s(1837);let d=(0,a.createContext)(void 0),i="auth_last_active";function l(e){let{children:t}=e,[s,l]=(0,a.useState)({user:null,isReady:!1}),c=(0,a.useRef)(0);(0,a.useEffect)(()=>{let e=!1;return(async()=>{var t,s;let r=await n.iJ.getSession();if(e)return;let a=null!==(s=null===(t=r.data)||void 0===t?void 0:t.user)&&void 0!==s?s:null;if(a){let e=Date.now();localStorage.setItem(i,String(e)),c.current=e}l({user:a,isReady:!0})})().catch(()=>{e||l({user:null,isReady:!0})}),()=>{e=!0}},[]);let o=(0,a.useCallback)(e=>{let t=Date.now();localStorage.setItem(i,String(t)),c.current=t,l({user:e,isReady:!0})},[]),u=(0,a.useCallback)(()=>{n.iJ.logout().catch(()=>void 0),localStorage.removeItem(i),c.current=0,l(e=>({user:null,isReady:e.isReady}))},[]),m=(0,a.useCallback)(e=>{l(t=>{if(!t.user)return t;let s={...t.user,...e};return{...t,user:s}})},[]);return(0,a.useEffect)(()=>{if(!s.user)return;let e=()=>{let e=Date.now();e-c.current<3e4||(c.current=e,localStorage.setItem(i,String(e)))},t=["mousemove","mousedown","keydown","scroll","touchstart"];t.forEach(t=>window.addEventListener(t,e,{passive:!0}));let r=window.setInterval(()=>{let e=localStorage.getItem(i),t=e?Number(e):0;t&&Date.now()-t>36e5&&u()},6e4);return()=>{t.forEach(t=>window.removeEventListener(t,e)),window.clearInterval(r)}},[s.user,u]),(0,r.jsx)(d.Provider,{value:{user:s.user,login:o,logout:u,updateUser:m,isAuthenticated:!!s.user,isReady:s.isReady},children:t})}function c(){let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1837:function(e,t,s){"use strict";s.d(t,{gL:function(){return i},i$:function(){return l},iJ:function(){return d}});let r={"Content-Type":"application/json"};async function a(e,t){try{let s=await fetch(e,{...t,credentials:"include",headers:{...r,...(null==t?void 0:t.headers)||{}}}),a=await s.json().catch(()=>null);if(!s.ok)return{error:(null==a?void 0:a.error)||s.statusText,status:s.status,details:a};return{data:a}}catch(e){return{error:e instanceof Error?e.message:"Request failed"}}}function n(e){let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[s,r]=e;void 0!==r&&""!==r&&t.append(s,String(r))});let s=t.toString();return s?"?".concat(s):""}let d={login:async(e,t)=>a("/api/auth/login",{method:"POST",body:JSON.stringify({ops_id:e,password:t})}),createSeatalkSession:async e=>a("/api/auth/seatalk/session",{method:"POST",body:JSON.stringify({session_id:e})}),seatalkLogin:async e=>a("/api/auth/seatalk/login",{method:"POST",body:JSON.stringify({session_id:e})}),checkSeatalkAuth:async e=>a("/api/auth/seatalk/check".concat(n({session_id:e})),{method:"GET"}),googleLogin:async e=>a("/api/auth/google",{method:"POST",body:JSON.stringify({id_token:e})}),getSession:async()=>a("/api/auth/me",{method:"GET"}),logout:async()=>a("/api/auth/logout",{method:"POST"}),changePassword:async(e,t,s)=>a("/api/auth/change-password",{method:"POST",body:JSON.stringify({ops_id:e,old_password:t,new_password:s})}),getUserById:async e=>a("/api/users/".concat(encodeURIComponent(e)),{method:"GET"}),getUser:async e=>a("/api/users/ops/".concat(encodeURIComponent(e)),{method:"GET"})},i={getUser:async e=>a("/api/users/ops/".concat(encodeURIComponent(e)),{method:"GET"}),getClusters:async(e,t)=>a("/api/lookup/clusters".concat(n({region:e,query:t})),{method:"GET"}),getHubs:async e=>a("/api/lookup/hubs".concat(n({cluster:e})),{method:"GET"}),getProcessors:async e=>a("/api/lookup/processors".concat(n({query:e})),{method:"GET"}),getLhTrip:async e=>a("/api/lookup/lh-trip".concat(n({lhTrip:e})),{method:"GET"})},l={submitRows:async(e,t)=>a("/api/dispatch/submit",{method:"POST",body:JSON.stringify({rows:e,submitted_by_ops_id:t})}),getDispatches:async e=>a("/api/dispatch".concat(n(e)),{method:"GET"}),verifyRows:async e=>a("/api/dispatch/verify",{method:"POST",body:JSON.stringify(e)})}},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return n},o:function(){return d}});var r=s(1994),a=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}function d(e){return e?new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}},4852:function(e,t,s){"use strict";s.d(t,{PrealertPage:function(){return L}});var r=s(7437),a=s(2265),n=s(9376),d=s(4881),i=s(9820),l=s(2381),c=s(279),o=s(3619),u=s(875),m=s(2135),h=s(401),x=s(3448);let f=o.fC;o.ZA;let p=o.B4,g=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(o.xz,{ref:t,className:(0,x.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[a,(0,r.jsx)(o.JO,{asChild:!0,children:(0,r.jsx)(u.Z,{className:"h-4 w-4 opacity-50"})})]})});g.displayName=o.xz.displayName;let b=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(o.u_,{ref:t,className:(0,x.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(m.Z,{className:"h-4 w-4"})})});b.displayName=o.u_.displayName;let j=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(o.$G,{ref:t,className:(0,x.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(u.Z,{className:"h-4 w-4"})})});j.displayName=o.$G.displayName;let v=a.forwardRef((e,t)=>{let{className:s,children:a,position:n="popper",...d}=e;return(0,r.jsx)(o.h_,{children:(0,r.jsxs)(o.VY,{ref:t,className:(0,x.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...d,children:[(0,r.jsx)(b,{}),(0,r.jsx)(o.l_,{className:(0,x.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(j,{})]})})});v.displayName=o.VY.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(o.__,{ref:t,className:(0,x.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=o.__.displayName;let N=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(o.ck,{ref:t,className:(0,x.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(o.wU,{children:(0,r.jsx)(h.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(o.eT,{children:a})]})});N.displayName=o.ck.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(o.Z0,{ref:t,className:(0,x.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=o.Z0.displayName;var y=s(8752),w=s(1723),k=s(9663),S=s(3639),C=s(5302),T=s(4924),E=s(2720),A=s(3247),P=s(2735),R=s(6266);let O="soc5_dispatch_reports",_=[{name:"Angongo Hub",batches:["Batch 1","Batch 2"]},{name:"Lipa Hub",batches:["Batch 1"]},{name:"Sto Tomas Hub",batches:["Batch 1","Batch 2","Batch 3"]}];function I(e){if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function D(e){if(!e)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/\"/g,'""'),'"'):t}function B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=["Pending","Acknowledged","Pending_Edit","Confirmed"],s=["OpsCoor1","PIC2","OpsCoor3","PIC4","User5","User6"],r=["Team A","Team B","Team C"],a=_.map(e=>e.name);return Array.from({length:e}).map((e,n)=>{let d=a[n%a.length],i=_.find(e=>e.name===d).batches,l=i[n%i.length],c=t[n%t.length],o=s[n%s.length],u="Pending"===c?void 0:r[n%r.length],m="PLT-".concat((100+n).toString().slice(-3)),h="2026-01-".concat(String(n%28+1).padStart(2,"0")),x=new Date(Date.now()-(n+1)*12e4).toISOString(),f="Pending_Edit"===c?"LH trip mismatch":void 0,p="Pending_Edit"===c?[{id:"edit-".concat(n),remarks:"Updated remarks after review.",reason:f||"",editor:o,timestamp:x}]:[];return{id:"r".concat(n+1),status:c,reporter:o,hub:d,batch:l,lh_trip:"LH".concat(100+n),plate:m,date:h,dataTeam:u,submittedBy:o,notes:"Sample note for report ".concat(n+1),createdAt:x,statusUpdatedAt:x,ackBy:"Pending"===c?void 0:u,ackAt:"Pending"===c?void 0:x,confirmedBy:"Confirmed"===c?u:void 0,confirmedAt:"Confirmed"===c?x:void 0,pendingEditReason:f,editCount:p.length,editHistory:p}})}function L(){let[e,t]=(0,a.useState)(""),[s,o]=(0,a.useState)("all"),[u,m]=(0,a.useState)(""),h=new Date().toISOString().slice(0,10),[x,b]=(0,a.useState)(h),[j,L]=(0,a.useState)(1),[z,U]=(0,a.useState)(10),[Z,H]=(0,a.useState)(()=>(function(){let e=window.localStorage.getItem(O);if(!e)return B(30);try{let t=JSON.parse(e);if(Array.isArray(t))return t}catch(e){}return B(30)})()),[M,G]=(0,a.useState)(null),[J,V]=(0,a.useState)(!1),[q,K]=(0,a.useState)(null),[Y,$]=(0,a.useState)(!1),[F,W]=(0,a.useState)({}),[X,Q]=(0,a.useState)(""),[ee,et]=(0,a.useState)(""),es=(0,a.useRef)(null),er=(0,a.useRef)(null),ea=(0,a.useRef)({}),{toast:en}=(0,y.pm)(),{user:ed}=(0,d.a)(),ei=(0,n.usePathname)(),el=(null==ei?void 0:ei.startsWith("/data-team"))||(null==ed?void 0:ed.role)==="Data Team"||(null==ed?void 0:ed.role)==="Admin";(0,a.useEffect)(()=>{window.localStorage.setItem(O,JSON.stringify(Z))},[Z]);let ec=(0,a.useCallback)(e=>!!ed&&(e.submittedByOpsId&&ed.ops_id?e.submittedByOpsId===ed.ops_id:e.submittedBy===ed.name||e.reporter===ed.name),[ed]),eo=(0,a.useMemo)(()=>el?Z.some(e=>"Pending"===e.status):Z.some(e=>"Pending_Edit"===e.status&&ec(e)),[Z,el,ec]);(0,a.useEffect)(()=>{if(!eo){es.current&&(clearInterval(es.current),es.current=null);return}let e=()=>{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;er.current||(er.current=new e);let t=er.current;"suspended"===t.state&&t.resume().catch(()=>{});let s=t.createOscillator(),r=t.createGain();s.type="sine",s.frequency.value=880,r.gain.value=.08,s.connect(r),r.connect(t.destination),s.start(),s.stop(t.currentTime+.2)};return e(),es.current||(es.current=setInterval(e,1500)),()=>{es.current&&(clearInterval(es.current),es.current=null)}},[eo]),(0,a.useEffect)(()=>{if(!ed||!el)return;let e=()=>{H(e=>{let t=!1,s=Date.now(),r=e.map(e=>{if("Pending"!==e.status||e.dataTeam)return e;let r=new Date(e.statusUpdatedAt||e.createdAt).getTime();return Number.isNaN(r)||s-r<3e5?e:(t=!0,{...e,dataTeam:ed.name,dataTeamOpsId:ed.ops_id})});return t?r:e})};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[ed,el]),(0,a.useEffect)(()=>{let e=ea.current,t={};Z.forEach(e=>{t[e.id]=e.status}),!el&&ed&&Z.forEach(t=>{if(!ec(t))return;let s=e[t.id];s&&s!==t.status&&"Acknowledged"===t.status&&t.ackBy&&en({title:"Report acknowledged",description:"".concat(t.id," acknowledged by ").concat(t.ackBy)})}),ea.current=t},[Z,el,ec,en,ed]);let eu=(0,a.useMemo)(()=>{let e={};return Z.forEach(t=>e[t.hub]=(e[t.hub]||0)+1),e},[Z]),em=(0,a.useMemo)(()=>x?Z.filter(e=>e.date===x):Z,[Z,x]),eh=em.filter(e=>"Pending"===e.status).length,ex=em.filter(e=>"Acknowledged"===e.status).length,ef=em.filter(e=>"Confirmed"===e.status).length,ep=(0,a.useMemo)(()=>Z.filter(t=>{if(u&&t.hub!==u||"all"!==s&&("Pending"===s&&"Pending"!==t.status||"Acknowledged"===s&&"Acknowledged"!==t.status||"Pending_Edit"===s&&"Pending_Edit"!==t.status||"Confirmed"===s&&"Confirmed"!==t.status)||x&&t.date!==x)return!1;if(e){let s=e.toLowerCase();if(!(t.reporter.toLowerCase().includes(s)||t.hub.toLowerCase().includes(s)||t.batch.toLowerCase().includes(s)||(t.lh_trip||"").toLowerCase().includes(s)||(t.plate||"").toLowerCase().includes(s)))return!1}return!0}),[Z,u,s,x,e]),eg=Math.max(1,Math.ceil(ep.length/z)),eb=ep.slice((j-1)*z,j*z),ej=e=>{switch(e){case"Pending":return{label:"Pending",icon:(0,r.jsx)(w.Z,{className:"h-4 w-4 text-yellow-600"}),className:"bg-yellow-50 text-yellow-700 border border-yellow-200"};case"Acknowledged":return{label:"Acknowledged",icon:(0,r.jsx)(k.Z,{className:"h-4 w-4 text-blue-600"}),className:"bg-blue-50 text-blue-700 border border-blue-200"};case"Pending_Edit":return{label:"Pending Edit",icon:(0,r.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}),className:"bg-red-50 text-red-700 border border-red-200"};case"Confirmed":return{label:"Confirmed",icon:(0,r.jsx)(C.Z,{className:"h-4 w-4 text-green-600"}),className:"bg-green-50 text-green-700 border border-green-200"};default:return{label:e,icon:null,className:"bg-muted text-muted-foreground"}}},ev="Pending"===s,eN="Acknowledged"===s,ey="Confirmed"===s,ew=(e,t)=>{G({hub:e,batch:t}),V(!0)},ek=e=>{K(e),Q(e.pendingEditReason||""),et(""),$(!0)},eS=(e,t)=>{H(s=>{let r=!1,a=s.map(s=>{if(s.id!==e)return s;let a=t(s);return a!==s&&(r=!0),a});return r?a:s})},eC=e=>{if(!ed){en({variant:"destructive",title:"Login required",description:"Please log in first."});return}eS(e.id,e=>e.dataTeam?e:{...e,dataTeam:ed.name,dataTeamOpsId:ed.ops_id}),en({title:"Ownership assigned",description:"Assigned to ".concat(ed.name)})},eT=e=>{if(!ed)return;let t=new Date().toISOString();eS(e.id,e=>"Pending"!==e.status?e:{...e,status:"Acknowledged",ackBy:ed.name,ackAt:t,dataTeam:e.dataTeam||ed.name,dataTeamOpsId:e.dataTeamOpsId||ed.ops_id,statusUpdatedAt:t}),en({title:"Acknowledged",description:"".concat(e.id," acknowledged by ").concat(ed.name)})},eE=e=>{if(!ed)return;if(!X.trim()){en({variant:"destructive",title:"Reason required",description:"Add a reason before sending Pending Edit."});return}let t=new Date().toISOString();eS(e.id,e=>({...e,status:"Pending_Edit",pendingEditReason:X.trim(),ackBy:e.ackBy||ed.name,ackAt:e.ackAt||t,dataTeam:e.dataTeam||ed.name,dataTeamOpsId:e.dataTeamOpsId||ed.ops_id,statusUpdatedAt:t})),en({title:"Pending Edit sent",description:"".concat(e.id," returned to Ops PIC.")})},eA=e=>{if(!ed)return;let t=new Date().toISOString(),s={...e,status:"Confirmed",confirmedBy:ed.name,confirmedAt:t,dataTeam:e.dataTeam||ed.name,dataTeamOpsId:e.dataTeamOpsId||ed.ops_id,statusUpdatedAt:t};eS(e.id,()=>s);let r=[s.id,s.lh_trip||"",s.hub,s.batch,s.plate||"",s.status,s.confirmedBy||"",s.confirmedAt||""],a=new Blob(["".concat("dispatch_id,lh_trip,hub,batch,plate,status,confirmed_by,confirmed_at","\n").concat(r.map(D).join(","))],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(a),d=document.createElement("a");d.href=n,d.download="dispatch-".concat(s.id,".csv"),d.click(),window.URL.revokeObjectURL(n),en({title:"Confirmed",description:"CSV downloaded. Seatalk and email dispatch queued."})},eP=e=>{if(!ed)return;if(!ee.trim()){en({variant:"destructive",title:"Remarks required",description:"Add remarks before resubmitting."});return}let t=new Date().toISOString();eS(e.id,e=>{let s={id:"".concat(e.id,"-").concat(Date.now()),remarks:ee.trim(),reason:e.pendingEditReason||"",editor:ed.name,timestamp:t},r=e.editHistory?[...e.editHistory,s]:[s];return{...e,status:"Pending",pendingEditReason:void 0,editCount:(e.editCount||0)+1,editHistory:r,notes:ee.trim(),statusUpdatedAt:t}}),en({title:"Resubmitted",description:"".concat(e.id," returned to Data Team queue.")}),et("")};return(0,r.jsxs)("div",{className:"flex gap-6",children:[(0,r.jsx)("aside",{className:"w-72",children:(0,r.jsxs)(i.Zb,{className:"sticky top-6",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{className:"text-lg",children:"Hubs"}),(0,r.jsx)(i.SZ,{className:"text-sm",children:"Compact list"})]}),(0,r.jsx)(i.aY,{children:(0,r.jsx)("ul",{className:"space-y-3 relative max-h-[60vh] overflow-y-auto pr-2",children:_.map(e=>(0,r.jsxs)("li",{className:"relative",children:[(0,r.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,r.jsxs)("button",{"aria-expanded":!!u&&u===e.name,"aria-controls":"batches-".concat(e.name),onClick:()=>{m(u===e.name?"":e.name),W(t=>({...t,[e.name]:!t[e.name]})),L(1)},onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),m(u===e.name?"":e.name),W(t=>({...t,[e.name]:!t[e.name]})),L(1))},className:"flex items-center gap-3 px-3 py-3 rounded w-full text-left ".concat(u===e.name?"bg-muted/20":"hover:bg-muted/10"),children:[(0,r.jsx)(T.Z,{className:"h-5 w-5 text-gradient"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[eu[e.name]||0," reports"]})]})]})}),(0,r.jsx)("div",{className:"absolute left-6 top-12 bottom-0 w-px bg-muted/20 ml-1","aria-hidden":!0}),(0,r.jsx)("ul",{id:"batches-".concat(e.name),className:"ml-9 mt-2 text-base text-muted-foreground space-y-2 ".concat(F[e.name]?"block":"hidden"),children:e.batches.map(t=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{className:"flex items-center gap-2 py-2 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-400 rounded",onClick:()=>ew(e.name,t),onKeyDown:s=>{"Enter"===s.key&&ew(e.name,t)},children:[(0,r.jsx)(E.Z,{className:"h-4 w-4 text-blue-500 mr-1","aria-hidden":!0}),(0,r.jsx)("span",{children:t})]})},t))})]},e.name))})})]})}),(0,r.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{role:"button",tabIndex:0,"aria-label":"Pending reports","aria-pressed":ev,onClick:()=>{o(ev?"all":"Pending"),L(1)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(ev?"all":"Pending"),L(1))},className:"cursor-pointer bg-white rounded-xl shadow-sm p-4 flex items-center gap-4 transform transition-all duration-150 border-r border-muted/20 pr-6 ".concat(ev?"ring-2 ring-yellow-300 scale-105":"hover:scale-105"),children:[(0,r.jsx)("div",{className:"".concat(ev?"inline-flex items-center justify-center h-16 w-16 rounded-full bg-yellow-600 text-white":"inline-flex items-center justify-center h-16 w-16 rounded-full bg-yellow-50 text-yellow-700"),children:(0,r.jsx)(w.Z,{className:"h-8 w-8","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Pending"}),(0,r.jsx)("div",{className:"text-3xl font-extrabold",children:eh}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:x})]})]}),(0,r.jsxs)("div",{role:"button",tabIndex:0,"aria-label":"Acknowledged reports","aria-pressed":eN,onClick:()=>{o(eN?"all":"Acknowledged"),L(1)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(eN?"all":"Acknowledged"),L(1))},className:"cursor-pointer bg-white rounded-xl shadow-sm p-4 flex items-center gap-4 transform transition-all duration-150 border-r border-muted/20 pr-6 ".concat(eN?"ring-2 ring-blue-300 scale-105":"hover:scale-105"),children:[(0,r.jsx)("div",{className:"".concat(eN?"inline-flex items-center justify-center h-16 w-16 rounded-full bg-blue-600 text-white":"inline-flex items-center justify-center h-16 w-16 rounded-full bg-blue-50 text-blue-700"),children:(0,r.jsx)(k.Z,{className:"h-8 w-8","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Acknowledged"}),(0,r.jsx)("div",{className:"text-3xl font-extrabold",children:ex}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:x})]})]}),(0,r.jsxs)("div",{role:"button",tabIndex:0,"aria-label":"Confirmed reports","aria-pressed":ey,onClick:()=>{o(ey?"all":"Confirmed"),L(1)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(ey?"all":"Confirmed"),L(1))},className:"cursor-pointer bg-white rounded-xl shadow-sm p-4 flex items-center gap-4 transform transition-all duration-150 ".concat(ey?"ring-2 ring-green-300 scale-105":"hover:scale-105"),children:[(0,r.jsx)("div",{className:"".concat(ey?"inline-flex items-center justify-center h-16 w-16 rounded-full bg-green-600 text-white":"inline-flex items-center justify-center h-16 w-16 rounded-full bg-green-50 text-green-700"),children:(0,r.jsx)(C.Z,{className:"h-8 w-8","aria-hidden":!0})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Confirmed"}),(0,r.jsx)("div",{className:"text-3xl font-extrabold",children:ef}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:x})]})]})]})}),(0,r.jsx)("div",{className:"my-6","aria-hidden":!0,children:(0,r.jsx)("div",{className:"h-0.5 w-full rounded shadow-sm bg-gradient-to-r from-sky-400 to-indigo-600"})}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(A.Z,{className:"absolute left-3 top-3 h-5 w-5 text-muted-foreground"}),(0,r.jsx)(c.I,{placeholder:"Search reporter, hub, LHTrip, plate...",className:"pl-11 w-96 text-base",value:e,onChange:e=>{t(e.target.value),L(1)},"aria-label":"Search reports"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(f,{value:s,onValueChange:e=>{o(e),L(1)},children:[(0,r.jsx)(g,{children:(0,r.jsx)(p,{placeholder:"All statuses"})}),(0,r.jsxs)(v,{children:[(0,r.jsx)(N,{value:"all",children:"All statuses"}),(0,r.jsx)(N,{value:"Pending",children:"Pending"}),(0,r.jsx)(N,{value:"Acknowledged",children:"Acknowledged"}),(0,r.jsx)(N,{value:"Pending_Edit",children:"Pending Edit"}),(0,r.jsx)(N,{value:"Confirmed",children:"Confirmed"})]})]}),(0,r.jsx)(c.I,{type:"date",value:x,onChange:e=>{b(e.target.value),L(1)},"aria-label":"Date"}),(0,r.jsx)(l.z,{variant:"outline",onClick:()=>{t(""),m(""),o("all"),b(""),L(1)},children:"Reset"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm",children:"Rows"}),(0,r.jsxs)(f,{value:String(z),onValueChange:e=>{U(Number(e)),L(1)},children:[(0,r.jsx)(g,{children:(0,r.jsx)(p,{placeholder:"10"})}),(0,r.jsxs)(v,{children:[(0,r.jsx)(N,{value:"10",children:"10"}),(0,r.jsx)(N,{value:"25",children:"25"}),(0,r.jsx)(N,{value:"50",children:"50"})]})]})]}),(0,r.jsxs)(l.z,{variant:"outline",onClick:()=>{en({title:"Export",description:"CSV export is not yet configured."})},children:[(0,r.jsx)(P.Z,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]})]}),(0,r.jsxs)(i.Zb,{children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{className:"text-xl",children:"Dispatch Entries"}),(0,r.jsxs)(i.SZ,{className:"text-sm",children:["Showing ",ep.length," entries, page ",j," / ",eg]})]}),(0,r.jsx)(i.aY,{children:0===ep.length?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"text-muted-foreground text-base",children:"No entries found"})}):(0,r.jsxs)("div",{className:"overflow-x-auto",children:[(0,r.jsxs)("table",{className:"w-full text-base border-collapse border border-muted/20",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b bg-muted/50",children:[(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Status"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Reporter"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Hub"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Batch"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"LHTrip"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Plate"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Date"}),(0,r.jsx)("th",{className:"p-3 text-center border-r border-muted/20 last:border-r-0",children:"Owner"}),(0,r.jsx)("th",{className:"p-3 text-center last:border-r-0",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:eb.map(e=>{let t=ej(e.status),s=el?"Pending"===e.status:"Pending_Edit"===e.status&&ec(e);return(0,r.jsxs)("tr",{className:"border-b hover:shadow-md hover:-translate-y-0.5 transition-all group ".concat(s?"blink-red ring-1 ring-red-300":""),tabIndex:0,onKeyDown:t=>{"Enter"===t.key&&ek(e)},"aria-label":"Report ".concat(e.id," by ").concat(e.reporter),children:[(0,r.jsx)("td",{className:"p-3 align-middle text-center border-r border-muted/20 last:border-r-0",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm font-medium ".concat(t.className),children:[t.icon,(0,r.jsx)("span",{className:"whitespace-nowrap",children:t.label})]})}),(0,r.jsx)("td",{className:"p-3 align-middle text-base border-r border-muted/20 last:border-r-0",children:e.reporter}),(0,r.jsx)("td",{className:"p-3 align-middle text-base border-r border-muted/20 last:border-r-0",children:e.hub}),(0,r.jsx)("td",{className:"p-3 align-middle text-base border-r border-muted/20 last:border-r-0",children:e.batch}),(0,r.jsx)("td",{className:"p-3 align-middle font-mono border-r border-muted/20 last:border-r-0",children:e.lh_trip}),(0,r.jsx)("td",{className:"p-3 align-middle font-mono border-r border-muted/20 last:border-r-0",children:e.plate}),(0,r.jsx)("td",{className:"p-3 align-middle border-r border-muted/20 last:border-r-0",children:e.date}),(0,r.jsx)("td",{className:"p-3 align-middle border-r border-muted/20 last:border-r-0",children:e.dataTeam||"-"}),(0,r.jsx)("td",{className:"p-3 align-middle",children:(0,r.jsx)(l.z,{size:"sm",variant:"ghost","aria-label":"Open details for ".concat(e.id),onClick:()=>ek(e),children:(0,r.jsx)(R.Z,{})})})]},e.id)})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",eb.length," of ",ep.length," entries"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(l.z,{size:"sm",variant:"outline",onClick:()=>L(Math.max(1,j-1)),disabled:1===j,children:"Previous"}),(0,r.jsxs)("div",{className:"text-sm",children:["Page ",j," / ",eg]}),(0,r.jsx)(l.z,{size:"sm",variant:"outline",onClick:()=>L(Math.min(eg,j+1)),disabled:j===eg,children:"Next"})]})]})]})})]}),J&&M&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:(0,r.jsxs)("div",{className:"w-full max-w-3xl bg-background rounded shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold",children:[M.hub," - ",M.batch]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(l.z,{variant:"outline",onClick:()=>{G(null),V(!1)},children:"Close"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Reports in this batch"}),(0,r.jsx)("div",{className:"overflow-y-auto max-h-72",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"Reporter"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Hub"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Batch"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"LHTrip"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Plate"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Date"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Owner"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Status"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:Z.filter(e=>e.hub===M.hub&&e.batch===M.batch).map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-muted/10",children:[(0,r.jsx)("td",{className:"p-2",children:e.reporter}),(0,r.jsx)("td",{className:"p-2",children:e.hub}),(0,r.jsx)("td",{className:"p-2",children:e.batch}),(0,r.jsx)("td",{className:"p-2",children:e.lh_trip}),(0,r.jsx)("td",{className:"p-2",children:e.plate}),(0,r.jsx)("td",{className:"p-2",children:e.date}),(0,r.jsx)("td",{className:"p-2",children:e.dataTeam||"-"}),(0,r.jsx)("td",{className:"p-2",children:e.status}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)(l.z,{size:"sm",variant:"outline",onClick:()=>ek(e),children:"Details"})})]},e.id))})]})})]})]})}),Y&&q&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:(0,r.jsxs)("div",{className:"w-full max-w-2xl bg-background rounded shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold",children:"Report Details"}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["ID: ",q.id," - ",q.date]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(l.z,{variant:"ghost",onClick:()=>{K(null),$(!1),Q(""),et("")},children:"Close"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-base",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Reporter"}),(0,r.jsx)("div",{className:"font-medium",children:q.reporter})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Hub"}),(0,r.jsx)("div",{className:"font-medium",children:q.hub})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Batch"}),(0,r.jsx)("div",{className:"font-medium",children:q.batch})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Owner"}),(0,r.jsx)("div",{className:"font-medium",children:q.dataTeam||"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"LH Trip"}),(0,r.jsx)("div",{className:"font-mono",children:q.lh_trip})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Plate"}),(0,r.jsx)("div",{className:"font-mono",children:q.plate})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Status"}),(0,r.jsx)("div",{className:"font-medium",children:q.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Acknowledged"}),(0,r.jsx)("div",{className:"font-medium",children:q.ackBy?"".concat(q.ackBy," (").concat(I(q.ackAt),")"):"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Confirmed"}),(0,r.jsx)("div",{className:"font-medium",children:q.confirmedBy?"".concat(q.confirmedBy," (").concat(I(q.confirmedAt),")"):"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Notes"}),(0,r.jsx)("div",{className:"font-medium",children:q.notes||"-"})]})]}),q.pendingEditReason&&(0,r.jsxs)("div",{className:"mt-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:["Pending Edit Reason: ",q.pendingEditReason]}),q.editHistory&&q.editHistory.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Edit History"}),(0,r.jsx)("div",{className:"space-y-2",children:q.editHistory.map(e=>(0,r.jsxs)("div",{className:"rounded border border-muted/30 p-3 text-sm",children:[(0,r.jsxs)("div",{className:"font-medium",children:[e.editor," - ",I(e.timestamp)]}),(0,r.jsxs)("div",{className:"text-muted-foreground",children:["Reason: ",e.reason||"-"]}),(0,r.jsxs)("div",{children:["Remarks: ",e.remarks]})]},e.id))})]}),el&&(0,r.jsxs)("div",{className:"mt-6 space-y-4",children:[!q.dataTeam&&(0,r.jsx)(l.z,{variant:"outline",onClick:()=>eC(q),children:"Take Ownership"}),"Pending"===q.status&&(0,r.jsx)(l.z,{onClick:()=>eT(q),children:"Acknowledge"}),("Pending"===q.status||"Acknowledged"===q.status)&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Pending Edit Reason"}),(0,r.jsx)("textarea",{value:X,onChange:e=>Q(e.target.value),className:"w-full min-h-[90px] rounded border border-muted/30 p-2 text-sm",placeholder:"Describe the discrepancy..."}),(0,r.jsx)(l.z,{variant:"destructive",onClick:()=>eE(q),children:"Send Pending Edit"})]}),"Acknowledged"===q.status&&(0,r.jsx)(l.z,{onClick:()=>eA(q),children:"Confirm and Download CSV"})]}),!el&&"Pending_Edit"===q.status&&ec(q)&&(0,r.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Updated Remarks"}),(0,r.jsx)("textarea",{value:ee,onChange:e=>et(e.target.value),className:"w-full min-h-[90px] rounded border border-muted/30 p-2 text-sm",placeholder:"Update remarks and resubmit..."}),(0,r.jsx)(l.z,{onClick:()=>eP(q),children:"Resubmit Report"})]})]})})]})]})}}}]);